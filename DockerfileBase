FROM python:3.11-alpine

LABEL com.abhinavsingh.name="abhinavsingh/proxy.py" \
    com.abhinavsingh.description="âš¡ Fast â€¢ ğŸª¶ Lightweight â€¢ 0ï¸âƒ£ Dependency â€¢ ğŸ”Œ Pluggable â€¢ \
    ğŸ˜ˆ TLS interception â€¢ ğŸ”’ DNS-over-HTTPS â€¢ ğŸ”¥ Poor Man's VPN â€¢ âª Reverse & â© Forward â€¢ \
    ğŸ‘®ğŸ¿ \"Proxy Server\" framework â€¢ ğŸŒ \"Web Server\" framework â€¢ âµ â¶ â· â  \"PubSub\" framework â€¢ \
    ğŸ‘· \"Work\" acceptor & executor framework" \
    com.abhinavsingh.url="https://github.com/abhinavsingh/proxy.py" \
    com.abhinavsingh.vcs-url="https://github.com/abhinavsingh/proxy.py" \
    com.abhinavsingh.docker.cmd="docker run -it --rm -p 8899:8899 abhinavsingh/proxy.py" \
    org.opencontainers.image.source="https://github.com/abhinavsingh/proxy.py"

ENV PYTHONUNBUFFERED 1

# Install paramiko and cryptography to allow
# users to use tunneling features using Docker
RUN apk update && apk --no-cache add \
    --virtual .builddeps \
    gcc \
    musl-dev \
    libffi-dev \
    openssl-dev \
    python3-dev \
    cargo \
    rust \
    make
RUN python -m venv /proxy/venv && \
    /proxy/venv/bin/pip install \
    -U pip wheel && \
    /proxy/venv/bin/pip install \
    paramiko==3.4.0 \
    cryptography==39.0.1 \
    --prefer-binary
RUN apk del .builddeps
